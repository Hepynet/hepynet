<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>hepynet.train.evaluate API documentation</title>
<meta name="description" content="Functions for making plots" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>hepynet.train.evaluate</code></h1>
</header>
<section id="section-intro">
<p>Functions for making plots</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;Functions for making plots&#34;&#34;&#34;

import copy
import json
import logging
import math
import warnings

import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns
from scipy.special import softmax
from sklearn.metrics import auc, roc_auc_score, roc_curve

from hepynet.common import array_utils, common_utils
from hepynet.data_io import feed_box, numpy_io
from hepynet.train import train_utils

try:
    import ROOT
    root_available = True
    from easy_atlas_plot.plot_utils import plot_utils_root, th1_tools
except ImportError:
    root_available = False

logger = logging.getLogger(&#34;hepynet&#34;)


def plot_2d_density(
    job_wrapper, save_plot=False, save_dir=None, save_file_name=&#34;2d_density&#34;,
):
    &#34;&#34;&#34;Plots 2D hist to see event distribution of signal and backgrounds events.

    x-axis will be dnn scores, y-axis will be mass parameter, z-axis is total
    weight shown by color

    &#34;&#34;&#34;
    ic = job_wrapper.job_config.input
    model_wrapper = job_wrapper.model_wrapper
    feedbox = model_wrapper.feedbox
    model_meta = model_wrapper.model_meta
    # plot signal
    sig_key = model_meta[&#34;sig_key&#34;]
    sig_arr_raw, _ = feedbox.get_raw(&#34;xs&#34;, array_key=sig_key)
    sig_arr, sig_weights = feedbox.get_reshape(&#34;xs&#34;, array_key=sig_key)
    predict_arr = model_wrapper.get_model().predict(sig_arr)
    if predict_arr.ndim == 2:
        predict_arr = predict_arr[:, 0]
    mass_index = ic.selected_features.index(ic.reset_feature_name)
    x = predict_arr
    y = sig_arr_raw[:, mass_index]
    ## make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_density_sig&#34;, &#34;2d_density_sig&#34;, 800, 600)
    hist_sig = th1_tools.TH2FTool(
        &#34;2d_density_sig&#34;,
        &#34;2d_density_sig&#34;,
        nbinx=50,
        xlow=0,
        xup=1.0,
        nbiny=50,
        ylow=min(y),
        yup=max(y),
    )
    hist_sig.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=sig_weights)
    hist_sig.set_canvas(plot_canvas)
    hist_sig.set_palette(&#34;kBird&#34;)
    hist_sig.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_sig.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn score&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass&#34;)
    hist_sig.draw(&#34;colz&#34;)
    hist_sig.save(save_dir=save_dir, save_file_name=save_file_name + &#34;_sig&#34;)
    # plot background
    bkg_key = model_meta[&#34;bkg_key&#34;]
    bkg_arr_raw, _ = feedbox.get_raw(&#34;xb&#34;, array_key=bkg_key)
    bkg_arr, bkg_weights = feedbox.get_reshape(&#34;xb&#34;, array_key=bkg_key)
    predict_arr = model_wrapper.get_model().predict(bkg_arr)
    if predict_arr.ndim == 2:
        predict_arr = predict_arr[:, 0]
    mass_index = ic.selected_features.index(ic.reset_feature_name)
    x = predict_arr
    y = bkg_arr_raw[:, mass_index]
    ## make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_density_bkg&#34;, &#34;2d_density_bkg&#34;, 800, 600)
    hist_bkg = th1_tools.TH2FTool(
        &#34;2d_density_bkg&#34;,
        &#34;2d_density_bkg&#34;,
        nbinx=50,
        xlow=0,
        xup=1.0,
        nbiny=50,
        ylow=min(y),
        yup=max(y),
    )
    hist_bkg.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=bkg_weights)
    hist_bkg.set_canvas(plot_canvas)
    hist_bkg.set_palette(&#34;kBird&#34;)
    hist_bkg.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_bkg.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn score&#34;)
    hist_bkg.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass&#34;)
    hist_bkg.draw(&#34;colz&#34;)
    hist_bkg.save(save_dir=save_dir, save_file_name=save_file_name + &#34;_bkg&#34;)


def plot_2d_significance_scan(
    job_wrapper,
    save_plot=False,
    save_dir=None,
    save_file_name=&#34;2d_significance&#34;,
    cut_ranges_dn=None,
    cut_ranges_up=None,
    dnn_cut_min=None,
    dnn_cut_max=None,
    dnn_cut_step=None,
):
    &#34;&#34;&#34;Makes 2d map of significance&#34;&#34;&#34;
    if not (dnn_cut_min and dnn_cut_max and dnn_cut_step):
        logging.warn(
            &#34;No complete dnn_cut specified, using default (min=0.5, max=1, step=0.05)&#34;
        )
        dnn_cut_min = 0.5
        dnn_cut_max = 1
        dnn_cut_step = 0.05
    dnn_cut_list = np.arange(dnn_cut_min, dnn_cut_max, dnn_cut_step)
    w_inputs = []
    logger.info(&#34;Making 2d significance scan.&#34;)
    ic = job_wrapper.job_config.input
    tc = job_wrapper.job_config.train
    ac = job_wrapper.job_config.apply
    rc = job_wrapper.job_config.run
    bkg_dict = numpy_io.load_npy_arrays(
        rc.npy_path,
        ic.campaign,
        ic.region,
        ic.channel,
        ic.bkg_list,
        ic.selected_features,
        validation_features=ic.validation_features,
        cut_features=ic.cut_features,
        cut_values=ic.cut_values,
        cut_types=ic.cut_types,
    )
    sig_dict = numpy_io.load_npy_arrays(
        rc.npy_path,
        ic.campaign,
        ic.region,
        ic.channel,
        ic.sig_list,
        ic.selected_features,
        validation_features=ic.validation_features,
        cut_features=ic.cut_features,
        cut_values=ic.cut_values,
        cut_types=ic.cut_types,
    )
    for sig_id, scan_sig_key in enumerate(ic.sig_list):
        xs = sig_dict[scan_sig_key]
        m_cut_name = ic.reset_feature_name
        if cut_ranges_dn is None or len(cut_ranges_dn) == 0:
            means, variances = train_utils.get_mean_var(
                xs[m_cut_name], axis=0, weights=xs[&#34;weight&#34;]
            )
            m_cut_dn = means[0] - math.sqrt(variances[0])
            m_cut_up = means[0] + math.sqrt(variances[0])
        else:
            m_cut_dn = cut_ranges_dn[sig_id]
            m_cut_up = cut_ranges_up[sig_id]
        feedbox = feed_box.Feedbox(
            sig_dict,
            bkg_dict,
            selected_features=ic.selected_features,
            apply_data=False,
            reshape_array=ic.norm_array,
            reset_mass=ic.reset_feature,
            reset_mass_name=ic.reset_feature_name,
            remove_negative_weight=ic.rm_negative_weight_events,
            cut_features=[m_cut_name, m_cut_name],
            cut_values=[m_cut_dn, m_cut_up],
            cut_types=[&#34;&gt;&#34;, &#34;&lt;&#34;],
            sig_weight=ic.sig_sumofweight,
            bkg_weight=ic.bkg_sumofweight,
            data_weight=ic.data_sumofweight,
            test_rate=ic.test_rate,
            rdm_seed=None,
            model_meta=job_wrapper.model_wrapper.model_meta,
            verbose=tc.verbose,
        )
        job_wrapper.model_wrapper.set_inputs(feedbox, apply_data=ac.apply_data)
        significance_algo = ac.cfg_2d_significance_scan[&#34;significance_algo&#34;]
        (plot_thresholds, significances, _, _,) = get_significances(
            job_wrapper.model_wrapper,
            ic.sig_key,
            ic.bkg_key,
            significance_algo=significance_algo,
        )
        plot_significances = []
        for dnn_cut in dnn_cut_list:
            threshold_id = (np.abs(np.array(plot_thresholds) - dnn_cut)).argmin()
            plot_significances.append(significances[threshold_id])
        w_inputs.append(plot_significances)
    x = []
    y = []
    w = []
    for index, w_input in enumerate(w_inputs):
        new_x = (dnn_cut_list + dnn_cut_step / 2).tolist()
        new_y = [ic.sig_list[index]] * len(w_input)
        new_w = w_input
        logging.debug(f&#34;new x: {new_x}&#34;)
        logging.debug(f&#34;new y: {new_y}&#34;)
        logging.debug(f&#34;new w: {new_w}&#34;)
        if len(x) == 0:
            x = new_x
            y = new_y
            w = new_w
        else:
            x += new_x
            y += new_y
            w += new_w
    # make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_significance_c&#34;, &#34;2d_significance_c&#34;, 800, 600)
    hist_sig = th1_tools.TH2FTool(
        &#34;2d_significance&#34;,
        &#34;2d_significance&#34;,
        nbinx=len(dnn_cut_list),
        xlow=dnn_cut_min,
        xup=dnn_cut_max,
        nbiny=len(ic.sig_list),
        ylow=0,
        yup=len(ic.sig_list),
    )
    hist_sig_text = th1_tools.TH2FTool(
        &#34;2d_significance_text&#34;,
        &#34;2d_significance_text&#34;,
        nbinx=len(dnn_cut_list),
        xlow=dnn_cut_min,
        xup=dnn_cut_max,
        nbiny=len(ic.sig_list),
        ylow=0,
        yup=len(ic.sig_list),
    )
    hist_sig.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=w)
    hist_sig.set_canvas(plot_canvas)
    hist_sig.set_palette(&#34;kBird&#34;)
    hist_sig.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_sig.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn_cut&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass point&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetLabelOffset&#34;, 0.003)
    hist_sig.draw(&#34;colz&#34;)
    hist_sig_text.fill_hist(
        fill_array_x=x, fill_array_y=y, weight_array=np.array(w).round(decimals=2)
    )
    hist_sig_text.set_canvas(plot_canvas)
    hist_sig_text.update_config(&#34;hist&#34;, &#34;SetMarkerSize&#34;, 1.8)
    hist_sig_text.draw(&#34;text same&#34;)
    if save_plot:
        plot_canvas.SaveAs(save_dir + &#34;/&#34; + save_file_name + &#34;.png&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="hepynet.train.evaluate.plot_2d_density"><code class="name flex">
<span>def <span class="ident">plot_2d_density</span></span>(<span>job_wrapper, save_plot=False, save_dir=None, save_file_name='2d_density')</span>
</code></dt>
<dd>
<div class="desc"><p>Plots 2D hist to see event distribution of signal and backgrounds events.</p>
<p>x-axis will be dnn scores, y-axis will be mass parameter, z-axis is total
weight shown by color</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_2d_density(
    job_wrapper, save_plot=False, save_dir=None, save_file_name=&#34;2d_density&#34;,
):
    &#34;&#34;&#34;Plots 2D hist to see event distribution of signal and backgrounds events.

    x-axis will be dnn scores, y-axis will be mass parameter, z-axis is total
    weight shown by color

    &#34;&#34;&#34;
    ic = job_wrapper.job_config.input
    model_wrapper = job_wrapper.model_wrapper
    feedbox = model_wrapper.feedbox
    model_meta = model_wrapper.model_meta
    # plot signal
    sig_key = model_meta[&#34;sig_key&#34;]
    sig_arr_raw, _ = feedbox.get_raw(&#34;xs&#34;, array_key=sig_key)
    sig_arr, sig_weights = feedbox.get_reshape(&#34;xs&#34;, array_key=sig_key)
    predict_arr = model_wrapper.get_model().predict(sig_arr)
    if predict_arr.ndim == 2:
        predict_arr = predict_arr[:, 0]
    mass_index = ic.selected_features.index(ic.reset_feature_name)
    x = predict_arr
    y = sig_arr_raw[:, mass_index]
    ## make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_density_sig&#34;, &#34;2d_density_sig&#34;, 800, 600)
    hist_sig = th1_tools.TH2FTool(
        &#34;2d_density_sig&#34;,
        &#34;2d_density_sig&#34;,
        nbinx=50,
        xlow=0,
        xup=1.0,
        nbiny=50,
        ylow=min(y),
        yup=max(y),
    )
    hist_sig.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=sig_weights)
    hist_sig.set_canvas(plot_canvas)
    hist_sig.set_palette(&#34;kBird&#34;)
    hist_sig.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_sig.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn score&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass&#34;)
    hist_sig.draw(&#34;colz&#34;)
    hist_sig.save(save_dir=save_dir, save_file_name=save_file_name + &#34;_sig&#34;)
    # plot background
    bkg_key = model_meta[&#34;bkg_key&#34;]
    bkg_arr_raw, _ = feedbox.get_raw(&#34;xb&#34;, array_key=bkg_key)
    bkg_arr, bkg_weights = feedbox.get_reshape(&#34;xb&#34;, array_key=bkg_key)
    predict_arr = model_wrapper.get_model().predict(bkg_arr)
    if predict_arr.ndim == 2:
        predict_arr = predict_arr[:, 0]
    mass_index = ic.selected_features.index(ic.reset_feature_name)
    x = predict_arr
    y = bkg_arr_raw[:, mass_index]
    ## make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_density_bkg&#34;, &#34;2d_density_bkg&#34;, 800, 600)
    hist_bkg = th1_tools.TH2FTool(
        &#34;2d_density_bkg&#34;,
        &#34;2d_density_bkg&#34;,
        nbinx=50,
        xlow=0,
        xup=1.0,
        nbiny=50,
        ylow=min(y),
        yup=max(y),
    )
    hist_bkg.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=bkg_weights)
    hist_bkg.set_canvas(plot_canvas)
    hist_bkg.set_palette(&#34;kBird&#34;)
    hist_bkg.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_bkg.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn score&#34;)
    hist_bkg.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass&#34;)
    hist_bkg.draw(&#34;colz&#34;)
    hist_bkg.save(save_dir=save_dir, save_file_name=save_file_name + &#34;_bkg&#34;)</code></pre>
</details>
</dd>
<dt id="hepynet.train.evaluate.plot_2d_significance_scan"><code class="name flex">
<span>def <span class="ident">plot_2d_significance_scan</span></span>(<span>job_wrapper, save_plot=False, save_dir=None, save_file_name='2d_significance', cut_ranges_dn=None, cut_ranges_up=None, dnn_cut_min=None, dnn_cut_max=None, dnn_cut_step=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Makes 2d map of significance</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_2d_significance_scan(
    job_wrapper,
    save_plot=False,
    save_dir=None,
    save_file_name=&#34;2d_significance&#34;,
    cut_ranges_dn=None,
    cut_ranges_up=None,
    dnn_cut_min=None,
    dnn_cut_max=None,
    dnn_cut_step=None,
):
    &#34;&#34;&#34;Makes 2d map of significance&#34;&#34;&#34;
    if not (dnn_cut_min and dnn_cut_max and dnn_cut_step):
        logging.warn(
            &#34;No complete dnn_cut specified, using default (min=0.5, max=1, step=0.05)&#34;
        )
        dnn_cut_min = 0.5
        dnn_cut_max = 1
        dnn_cut_step = 0.05
    dnn_cut_list = np.arange(dnn_cut_min, dnn_cut_max, dnn_cut_step)
    w_inputs = []
    logger.info(&#34;Making 2d significance scan.&#34;)
    ic = job_wrapper.job_config.input
    tc = job_wrapper.job_config.train
    ac = job_wrapper.job_config.apply
    rc = job_wrapper.job_config.run
    bkg_dict = numpy_io.load_npy_arrays(
        rc.npy_path,
        ic.campaign,
        ic.region,
        ic.channel,
        ic.bkg_list,
        ic.selected_features,
        validation_features=ic.validation_features,
        cut_features=ic.cut_features,
        cut_values=ic.cut_values,
        cut_types=ic.cut_types,
    )
    sig_dict = numpy_io.load_npy_arrays(
        rc.npy_path,
        ic.campaign,
        ic.region,
        ic.channel,
        ic.sig_list,
        ic.selected_features,
        validation_features=ic.validation_features,
        cut_features=ic.cut_features,
        cut_values=ic.cut_values,
        cut_types=ic.cut_types,
    )
    for sig_id, scan_sig_key in enumerate(ic.sig_list):
        xs = sig_dict[scan_sig_key]
        m_cut_name = ic.reset_feature_name
        if cut_ranges_dn is None or len(cut_ranges_dn) == 0:
            means, variances = train_utils.get_mean_var(
                xs[m_cut_name], axis=0, weights=xs[&#34;weight&#34;]
            )
            m_cut_dn = means[0] - math.sqrt(variances[0])
            m_cut_up = means[0] + math.sqrt(variances[0])
        else:
            m_cut_dn = cut_ranges_dn[sig_id]
            m_cut_up = cut_ranges_up[sig_id]
        feedbox = feed_box.Feedbox(
            sig_dict,
            bkg_dict,
            selected_features=ic.selected_features,
            apply_data=False,
            reshape_array=ic.norm_array,
            reset_mass=ic.reset_feature,
            reset_mass_name=ic.reset_feature_name,
            remove_negative_weight=ic.rm_negative_weight_events,
            cut_features=[m_cut_name, m_cut_name],
            cut_values=[m_cut_dn, m_cut_up],
            cut_types=[&#34;&gt;&#34;, &#34;&lt;&#34;],
            sig_weight=ic.sig_sumofweight,
            bkg_weight=ic.bkg_sumofweight,
            data_weight=ic.data_sumofweight,
            test_rate=ic.test_rate,
            rdm_seed=None,
            model_meta=job_wrapper.model_wrapper.model_meta,
            verbose=tc.verbose,
        )
        job_wrapper.model_wrapper.set_inputs(feedbox, apply_data=ac.apply_data)
        significance_algo = ac.cfg_2d_significance_scan[&#34;significance_algo&#34;]
        (plot_thresholds, significances, _, _,) = get_significances(
            job_wrapper.model_wrapper,
            ic.sig_key,
            ic.bkg_key,
            significance_algo=significance_algo,
        )
        plot_significances = []
        for dnn_cut in dnn_cut_list:
            threshold_id = (np.abs(np.array(plot_thresholds) - dnn_cut)).argmin()
            plot_significances.append(significances[threshold_id])
        w_inputs.append(plot_significances)
    x = []
    y = []
    w = []
    for index, w_input in enumerate(w_inputs):
        new_x = (dnn_cut_list + dnn_cut_step / 2).tolist()
        new_y = [ic.sig_list[index]] * len(w_input)
        new_w = w_input
        logging.debug(f&#34;new x: {new_x}&#34;)
        logging.debug(f&#34;new y: {new_y}&#34;)
        logging.debug(f&#34;new w: {new_w}&#34;)
        if len(x) == 0:
            x = new_x
            y = new_y
            w = new_w
        else:
            x += new_x
            y += new_y
            w += new_w
    # make plot
    plot_canvas = ROOT.TCanvas(&#34;2d_significance_c&#34;, &#34;2d_significance_c&#34;, 800, 600)
    hist_sig = th1_tools.TH2FTool(
        &#34;2d_significance&#34;,
        &#34;2d_significance&#34;,
        nbinx=len(dnn_cut_list),
        xlow=dnn_cut_min,
        xup=dnn_cut_max,
        nbiny=len(ic.sig_list),
        ylow=0,
        yup=len(ic.sig_list),
    )
    hist_sig_text = th1_tools.TH2FTool(
        &#34;2d_significance_text&#34;,
        &#34;2d_significance_text&#34;,
        nbinx=len(dnn_cut_list),
        xlow=dnn_cut_min,
        xup=dnn_cut_max,
        nbiny=len(ic.sig_list),
        ylow=0,
        yup=len(ic.sig_list),
    )
    hist_sig.fill_hist(fill_array_x=x, fill_array_y=y, weight_array=w)
    hist_sig.set_canvas(plot_canvas)
    hist_sig.set_palette(&#34;kBird&#34;)
    hist_sig.update_config(&#34;hist&#34;, &#34;SetStats&#34;, 0)
    hist_sig.update_config(&#34;x_axis&#34;, &#34;SetTitle&#34;, &#34;dnn_cut&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetTitle&#34;, &#34;mass point&#34;)
    hist_sig.update_config(&#34;y_axis&#34;, &#34;SetLabelOffset&#34;, 0.003)
    hist_sig.draw(&#34;colz&#34;)
    hist_sig_text.fill_hist(
        fill_array_x=x, fill_array_y=y, weight_array=np.array(w).round(decimals=2)
    )
    hist_sig_text.set_canvas(plot_canvas)
    hist_sig_text.update_config(&#34;hist&#34;, &#34;SetMarkerSize&#34;, 1.8)
    hist_sig_text.draw(&#34;text same&#34;)
    if save_plot:
        plot_canvas.SaveAs(save_dir + &#34;/&#34; + save_file_name + &#34;.png&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="hepynet.train" href="index.html">hepynet.train</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="hepynet.train.evaluate.plot_2d_density" href="#hepynet.train.evaluate.plot_2d_density">plot_2d_density</a></code></li>
<li><code><a title="hepynet.train.evaluate.plot_2d_significance_scan" href="#hepynet.train.evaluate.plot_2d_significance_scan">plot_2d_significance_scan</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>